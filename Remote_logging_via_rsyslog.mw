Nelle ultime versioni di Fedora non viene più utilizzato syslog ma rsyslog per gestire il logging degli eventi di sistema. Il demone rsyslog permette una più dinamica gestione dei logging implementando regole di filtering e controllo dei messaggi.
Nel nostro esempio verrà abilitato il logging remoto dal client "lvmtest" (IP 192.168.1.10) al server "cellopc-mini (IP 192.168.1.10).<br /><br /><strong>Server</strong><br /><br />Per prima cosa verificare che il demone rsyslog sia attivo sul nostro sistema.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># service rsyslog status
<br /></span><span style="color: #0000BB">rsyslogd </span><span style="color: #007700">(</span><span style="color: #0000BB">pid  10015</span><span style="color: #007700">) </span><span style="color: #0000BB">is running</span><span style="color: #007700">...
<br /></span><span style="color: #0000BB"></span>
</span>
</code></div><br /><br />Ora eseguire un backup del file di configurazione /etc/rsyslog.conf per eventuali rollback.<br /><br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># cp /etc/rsyslog.conf /etc/rsyslog.conf.orig
<br /></span><span style="color: #0000BB"></span>
</span>
</code></div><br /><br />E' possibile mettere in ascolto il demone rsyslog per gli inoltri dei client tramite protocollo TCP o UDP sulla porta 514. Nel nostro esempio verrà utilizzato il protocollo UDP. Per prima cosa scommentare la direttiva "$ModLoad" del modulo "imdup.so" e poi la direttiva "UDPServerRun" per la porta 514.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># diff -ub rsyslog.conf.orig rsyslog.conf
<br /></span><span style="color: #007700">--- </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf</span><span style="color: #007700">.</span><span style="color: #0000BB">orig    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 14</span><span style="color: #007700">:</span><span style="color: #0000BB">06</span><span style="color: #007700">:</span><span style="color: #0000BB">03.915173003 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">+++ </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 15</span><span style="color: #007700">:</span><span style="color: #0000BB">08</span><span style="color: #007700">:</span><span style="color: #0000BB">14.692173002 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">@@ -</span><span style="color: #0000BB">10</span><span style="color: #007700">,</span><span style="color: #0000BB">14 </span><span style="color: #007700">+</span><span style="color: #0000BB">10</span><span style="color: #007700">,</span><span style="color: #0000BB">15 </span><span style="color: #007700">@@
<br />-</span><span style="color: #FF8000">#$ModLoad imudp.so
<br /></span><span style="color: #007700">-</span><span style="color: #FF8000">#$UDPServerRun 514
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$ModLoad imudp</span><span style="color: #007700">.</span><span style="color: #0000BB">so
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$UDPServerRun 514
<br /></span>
</span>
</code></div><br /><br />E' possibile anche specificare l'indirizzo IP dove rimarrà in ascolto il servizio rsyslog per restringere il bind della porta sul sistema tramite la direttiva "UDPServerAddress" specificando l'indirizzo IP.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># diff -ub rsyslog.conf.orig rsyslog.conf
<br /></span><span style="color: #007700">--- </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf</span><span style="color: #007700">.</span><span style="color: #0000BB">orig    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 14</span><span style="color: #007700">:</span><span style="color: #0000BB">06</span><span style="color: #007700">:</span><span style="color: #0000BB">03.915173003 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">+++ </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 15</span><span style="color: #007700">:</span><span style="color: #0000BB">08</span><span style="color: #007700">:</span><span style="color: #0000BB">14.692173002 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">@@ -</span><span style="color: #0000BB">10</span><span style="color: #007700">,</span><span style="color: #0000BB">14 </span><span style="color: #007700">+</span><span style="color: #0000BB">10</span><span style="color: #007700">,</span><span style="color: #0000BB">15 </span><span style="color: #007700">@@
<br />-</span><span style="color: #FF8000">#$ModLoad imudp.so
<br /></span><span style="color: #007700">-</span><span style="color: #FF8000">#$UDPServerRun 514
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$ModLoad imudp</span><span style="color: #007700">.</span><span style="color: #0000BB">so
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$UDPServerRun 514
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$UDPServerAddress 192.168.1.1
<br /></span>
</span>
</code></div><br /><br />Inoltre è possibile ridurre le subnet (o IP singoli) che possono inviare dei messaggi al nostro server rsyslog tramite la direttiva "AllowedSender" specificando il protocollo e la subnet di origine.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># diff -ub rsyslog.conf.orig rsyslog.conf
<br /></span><span style="color: #007700">--- </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf</span><span style="color: #007700">.</span><span style="color: #0000BB">orig    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 14</span><span style="color: #007700">:</span><span style="color: #0000BB">06</span><span style="color: #007700">:</span><span style="color: #0000BB">03.915173003 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">+++ </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 15</span><span style="color: #007700">:</span><span style="color: #0000BB">08</span><span style="color: #007700">:</span><span style="color: #0000BB">14.692173002 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">@@ -</span><span style="color: #0000BB">10</span><span style="color: #007700">,</span><span style="color: #0000BB">14 </span><span style="color: #007700">+</span><span style="color: #0000BB">10</span><span style="color: #007700">,</span><span style="color: #0000BB">15 </span><span style="color: #007700">@@
<br />-</span><span style="color: #FF8000">#$ModLoad imudp.so
<br /></span><span style="color: #007700">-</span><span style="color: #FF8000">#$UDPServerRun 514
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$ModLoad imudp</span><span style="color: #007700">.</span><span style="color: #0000BB">so
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$UDPServerRun 514
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$UDPServerAddress 192.168.1.1
<br /></span><span style="color: #007700">+</span><span style="color: #0000BB">$AllowedSender UDP</span><span style="color: #007700">, </span><span style="color: #0000BB">192.168.1.0</span><span style="color: #007700">/</span><span style="color: #0000BB">24
<br /></span>
</span>
</code></div><br /><br />Al termine delle modifiche eseguire il riavvio del servizio rsyslog e poi veriicare che la porta 514 sia in LISTEN sul nostro server.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># service rsyslog restart
<br /></span><span style="color: #0000BB"></span>
</span>
</code></div><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># netstat -anup | grep 514
<br /></span><span style="color: #0000BB">udp        0      0 0.0.0.0</span><span style="color: #007700">:</span><span style="color: #0000BB">514                 0.0.0.0</span><span style="color: #007700">:*                               </span><span style="color: #0000BB">10015</span><span style="color: #007700">/</span><span style="color: #0000BB">rsyslogd
<br /></span>
</span>
</code></div><br /><br />Si dovrà ora aggiungere la regola per redirigere tutti i messaggi di un determinato host in un file specifico. Per questo si potrà aggiungere la direttiva "+" seguita dal nome host ed automatica se verrà intercattato il nome dell'host indicato verrano eseguite le direttive sotto riportate. Nel nostro esempio verrà rediretto tutto nel log "/var/log/lvmtest.log"<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># diff -ub rsyslog.conf.orig rsyslog.conf
<br /></span><span style="color: #007700">--- </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf</span><span style="color: #007700">.</span><span style="color: #0000BB">orig    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 14</span><span style="color: #007700">:</span><span style="color: #0000BB">06</span><span style="color: #007700">:</span><span style="color: #0000BB">03.915173003 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">+++ </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 15</span><span style="color: #007700">:</span><span style="color: #0000BB">08</span><span style="color: #007700">:</span><span style="color: #0000BB">14.692173002 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">@@ -</span><span style="color: #0000BB">30</span><span style="color: #007700">,</span><span style="color: #0000BB">13 </span><span style="color: #007700">+</span><span style="color: #0000BB">31</span><span style="color: #007700">,</span><span style="color: #0000BB">16 </span><span style="color: #007700">@@
<br />++</span><span style="color: #0000BB">lvmtest
<br /></span><span style="color: #007700">+*.*     /var/</span><span style="color: #0000BB">log</span><span style="color: #007700">/</span><span style="color: #0000BB">lvmtest</span><span style="color: #007700">.</span><span style="color: #0000BB">log
<br /></span>
</span>
</code></div><br /><br />Si dovrà poi aggiungere un esclusion nella regola per il file /var/log/messages in modo da non avere i messaggi duplicati all'interno del file messages ma solo nel file in precedenza impostato. Basterà aggiungere le voci "<nomehost>.none".<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># diff -ub rsyslog.conf.orig rsyslog.conf
<br /></span><span style="color: #007700">--- </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf</span><span style="color: #007700">.</span><span style="color: #0000BB">orig    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 14</span><span style="color: #007700">:</span><span style="color: #0000BB">06</span><span style="color: #007700">:</span><span style="color: #0000BB">03.915173003 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">+++ </span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 15</span><span style="color: #007700">:</span><span style="color: #0000BB">08</span><span style="color: #007700">:</span><span style="color: #0000BB">14.692173002 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">-*.</span><span style="color: #0000BB">info</span><span style="color: #007700">;</span><span style="color: #0000BB">mail</span><span style="color: #007700">.</span><span style="color: #0000BB">none</span><span style="color: #007700">;</span><span style="color: #0000BB">authpriv</span><span style="color: #007700">.</span><span style="color: #0000BB">none</span><span style="color: #007700">;</span><span style="color: #0000BB">cron</span><span style="color: #007700">.</span><span style="color: #0000BB">none                </span><span style="color: #007700">/var/</span><span style="color: #0000BB">log</span><span style="color: #007700">/</span><span style="color: #0000BB">messages
<br /></span><span style="color: #007700">+*.</span><span style="color: #0000BB">info</span><span style="color: #007700">;</span><span style="color: #0000BB">mail</span><span style="color: #007700">.</span><span style="color: #0000BB">none</span><span style="color: #007700">;</span><span style="color: #0000BB">authpriv</span><span style="color: #007700">.</span><span style="color: #0000BB">none</span><span style="color: #007700">;</span><span style="color: #0000BB">cron</span><span style="color: #007700">.</span><span style="color: #0000BB">none</span><span style="color: #007700">;</span><span style="color: #0000BB">lvmtest</span><span style="color: #007700">.</span><span style="color: #0000BB">none                </span><span style="color: #007700">/var/</span><span style="color: #0000BB">log</span><span style="color: #007700">/</span><span style="color: #0000BB">messages
<br /></span>
</span>
</code></div><br /><br />Al termine delle modifiche eseguire il riavvio del servizio rsyslog.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># service rsyslog restart
<br /></span><span style="color: #0000BB"></span>
</span>
</code></div><br /><br /><strong>Client</strong><br /><br />Per prima cosa verificare che il demone rsyslog sia attivo sul nostro sistema.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">lvmtest </span><span style="color: #007700">~]</span><span style="color: #FF8000"># service rsyslog status
<br /></span><span style="color: #0000BB">rsyslogd </span><span style="color: #007700">(</span><span style="color: #0000BB">pid  1057</span><span style="color: #007700">) </span><span style="color: #0000BB">is running</span><span style="color: #007700">...
<br /></span><span style="color: #0000BB"></span>
</span>
</code></div><br /><br />Ora eseguire un backup del file di configurazione /etc/rsyslog.conf per eventuali rollback.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">lvmtest </span><span style="color: #007700">~]</span><span style="color: #FF8000">#  cp /etc/rsyslog.conf /etc/rsyslog.conf.orig
<br /></span><span style="color: #0000BB"></span>
</span>
</code></div><br /><br />Nel file di configurazione basterà decidere quali facility inviare al server remoto e poi l'indirizzo del server. Nel nostro esempio verranno girate tutte le facility verso il server remoto.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">lvmtest </span><span style="color: #007700">~]</span><span style="color: #FF8000"># diff -ub /etc/rsyslog.conf.orig /etc/rsyslog.conf
<br /></span><span style="color: #007700">--- /</span><span style="color: #0000BB">etc</span><span style="color: #007700">/</span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf</span><span style="color: #007700">.</span><span style="color: #0000BB">orig    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 12</span><span style="color: #007700">:</span><span style="color: #0000BB">41</span><span style="color: #007700">:</span><span style="color: #0000BB">42.491661001 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">+++ /</span><span style="color: #0000BB">etc</span><span style="color: #007700">/</span><span style="color: #0000BB">rsyslog</span><span style="color: #007700">.</span><span style="color: #0000BB">conf    2011</span><span style="color: #007700">-</span><span style="color: #0000BB">05</span><span style="color: #007700">-</span><span style="color: #0000BB">04 12</span><span style="color: #007700">:</span><span style="color: #0000BB">42</span><span style="color: #007700">:</span><span style="color: #0000BB">46.236661001 </span><span style="color: #007700">+</span><span style="color: #0000BB">0200
<br /></span><span style="color: #007700">@@ -</span><span style="color: #0000BB">57</span><span style="color: #007700">,</span><span style="color: #0000BB">6 </span><span style="color: #007700">+</span><span style="color: #0000BB">57</span><span style="color: #007700">,</span><span style="color: #0000BB">8 </span><span style="color: #007700">@@
<br />+*.*        @</span><span style="color: #0000BB">192.168.1.1
<br /></span>
</span>
</code></div><br /><br />Al termine delle modifiche eseguire il riavvio del servizio rsyslog.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">lvmtest </span><span style="color: #007700">~]</span><span style="color: #FF8000"># service rsyslog restart
<br /></span><span style="color: #0000BB"></span>
</span>
</code></div><br /><br /><strong>Test</strong><br /><br />Sul client si potrà sfruttare il comando logger per poter inviare un messaggio a rsyslog con una certa facility. La facility si potrà specificare con l'opzione "-p".<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">lvmtest </span><span style="color: #007700">~]</span><span style="color: #FF8000"># logger -p "local0.error" "test rsyslog"
<br /></span><span style="color: #0000BB"></span>
</span>
</code></div><br /><br />Stando in tail sui log /var/log/messages e /var/log/lvmtest.log del server si noterà che il messaggio perverrà solo nel file associato al nostro host remoto.<br /><br /><div class="xoopsCode"><code><span style="color: #000000">
<span style="color: #0000BB">
<br /></span><span style="color: #007700">[</span><span style="color: #0000BB">root</span><span style="color: #007700">@</span><span style="color: #0000BB">cellopc</span><span style="color: #007700">-</span><span style="color: #0000BB">mini etc</span><span style="color: #007700">]</span><span style="color: #FF8000"># tail -f /var/log/messages /var/log/lvmtest.log 
<br /></span><span style="color: #007700">==> /var/</span><span style="color: #0000BB">log</span><span style="color: #007700">/</span><span style="color: #0000BB">messages </span><span style="color: #007700"><==
<br />
<br />==> /var/</span><span style="color: #0000BB">log</span><span style="color: #007700">/</span><span style="color: #0000BB">lvmtest</span><span style="color: #007700">.</span><span style="color: #0000BB">log </span><span style="color: #007700"><==
<br /></span><span style="color: #0000BB">May  4 14</span><span style="color: #007700">:</span><span style="color: #0000BB">21</span><span style="color: #007700">:</span><span style="color: #0000BB">18 lvmtest root</span><span style="color: #007700">: </span><span style="color: #0000BB">test rsyslog
<br /></span>
</span>
</code></div>
